name: Docker Image CI

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
  workflow_dispatch: 
    inputs: 
      version: 
        description: 'Version tag for Docker Image'
        required: true
env: 
  REGISTRY: docker.io
  IMAGE_NAME: dpakeeru/simpletomcatgit

jobs:

  build:

    runs-on: ubuntu-latest
    environment: DOCKERHUB_CREDENTIALS

    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v3

      - name: Set up Java
        uses: actions/setup-java@v3
        with: 
          java-version: '17'
          distribution: 'temurin'

      - name: Build War File
        run: mvn clean package

      - name: Log in to Docker Hub
        uses: docker/login-action@v3
        with: 
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Build Docker Image
        run: |
          docker build -t ${{ env.IMAGE_NAME }}:${{ github.event.inputs.version}} .

      - name: Push Docker image
        run: |
          docker push ${{ env.IMAGE_NAME }}:${{ github.event.inputs.version}}
          
